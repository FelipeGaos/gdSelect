class GDSelect{constructor(e,t={}){this.select="string"==typeof e?document.querySelector(e):e,this.config=Object.assign({search:!0,placeholder:"Seleccione...",multiple:this.select.hasAttribute("multiple"),multipleSelectedText:"opciones seleccionadas"},t),this.multiple=this.config.multiple,this.selectedValues=new Set,this.build(),this.bindEvents(),this.observeClassChanges(),this.setupValidationObserver()}build(){if(this.select.style.display="none",this.wrapper=document.createElement("div"),this.wrapper.classList.add("gdselect-wrapper"),this.select.className){this.select.className.split(" ").forEach((e=>{e&&!this.wrapper.classList.contains(e)&&this.wrapper.classList.add(e)}))}if(this.wrapper.tabIndex=0,this.header=document.createElement("div"),this.header.classList.add("gdselect-header"),this.header.textContent=this.config.placeholder,this.wrapper.appendChild(this.header),this.dropdown=document.createElement("div"),this.dropdown.classList.add("gdselect-dropdown"),this.config.search){const e=document.createElement("div");e.classList.add("gdselect-search-container"),this.searchInput=document.createElement("input"),this.searchInput.type="text",this.searchInput.classList.add("gdselect-search"),this.searchInput.placeholder="Buscar...",e.appendChild(this.searchInput),this.dropdown.appendChild(e)}Array.from(this.select.options).forEach((e=>{const t=document.createElement("div");t.classList.add("gdselect-option"),t.dataset.value=e.value,t.textContent=e.textContent,e.disabled&&t.classList.add("disabled"),e.selected&&(t.classList.add("selected"),this.selectedValues.add(e.value)),this.dropdown.appendChild(t)})),this.wrapper.appendChild(this.dropdown),this.select.parentNode.insertBefore(this.wrapper,this.select.nextSibling),this.updateHeader()}observeClassChanges(){this.observer=new MutationObserver((e=>{e.forEach((e=>{if("attributes"===e.type&&"class"===e.attributeName){const e=this.select.className.split(" ");Array.from(this.wrapper.classList).forEach((t=>{"gdselect-wrapper"===t||e.includes(t)||this.wrapper.classList.remove(t)})),e.forEach((e=>{e&&!this.wrapper.classList.contains(e)&&this.wrapper.classList.add(e)}))}}))})),this.observer.observe(this.select,{attributes:!0,attributeFilter:["class"]})}setupValidationObserver(){let e=this.select.closest("form");if(e){new MutationObserver((t=>{t.forEach((t=>{"attributes"===t.type&&"class"===t.attributeName&&e.classList.contains("was-validated")&&this.updateValidationState()}))})).observe(e,{attributes:!0,attributeFilter:["class"]}),e.addEventListener("submit",(()=>{setTimeout((()=>this.updateValidationState()),0)}))}this.select.addEventListener("change",(()=>{e&&e.classList.contains("was-validated")&&this.updateValidationState()}))}updateValidationState(){this.select.checkValidity()?(this.wrapper.classList.remove("is-invalid"),this.wrapper.classList.add("is-valid")):(this.wrapper.classList.remove("is-valid"),this.wrapper.classList.add("is-invalid"))}bindEvents(){this.wrapper.addEventListener("click",(e=>{e.target.classList.contains("gdselect-option")&&!e.target.classList.contains("disabled")?this.toggleOption(e.target):(this.dropdown.classList.toggle("open"),this.config.search&&this.dropdown.classList.contains("open")?(this.searchInput.style.display="block",this.searchInput.focus()):this.config.search&&(this.searchInput.style.display="none",this.searchInput.value="",this.filterOptions("")))})),this.config.search&&this.searchInput.addEventListener("input",(()=>{this.filterOptions(this.searchInput.value.toLowerCase())})),document.addEventListener("click",(e=>{this.wrapper.contains(e.target)||(this.dropdown.classList.remove("open"),this.config.search&&(this.searchInput.style.display="none",this.searchInput.value="",this.filterOptions("")))}))}filterOptions(e){this.dropdown.querySelectorAll(".gdselect-option").forEach((t=>{const s=t.textContent.toLowerCase();t.style.display=s.includes(e)?"block":"none"}))}toggleOption(e){const t=e.dataset.value;this.multiple?this.selectedValues.has(t)?(this.selectedValues.delete(t),e.classList.remove("selected")):(this.selectedValues.add(t),e.classList.add("selected")):(this.selectedValues.clear(),this.selectedValues.add(t),this.dropdown.querySelectorAll(".gdselect-option").forEach((e=>e.classList.remove("selected"))),e.classList.add("selected"),this.dropdown.classList.remove("open")),this.updateHeader(),this.syncSelect(),this.updateValidationState()}updateHeader(){if(0===this.selectedValues.size)this.header.textContent=this.config.placeholder;else if(this.multiple)this.header.textContent=`${this.selectedValues.size} ${this.config.multipleSelectedText}`;else{const e=[...this.selectedValues][0],t=Array.from(this.select.options).find((t=>t.value===e));this.header.textContent=t?t.textContent:this.config.placeholder}}syncSelect(){Array.from(this.select.options).forEach((e=>{e.selected=this.selectedValues.has(e.value)}));const e=new Event("change",{bubbles:!0});this.select.dispatchEvent(e)}setValue(e){Array.isArray(e)||(e=[e]),this.selectedValues=new Set(e.map(String)),this.dropdown.querySelectorAll(".gdselect-option").forEach((e=>{e.classList.toggle("selected",this.selectedValues.has(e.dataset.value))})),this.updateHeader(),this.syncSelect(),this.updateValidationState()}getValue(){return this.multiple?[...this.selectedValues]:[...this.selectedValues][0]||null}}